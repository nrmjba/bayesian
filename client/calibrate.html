<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
	<head>
		<title>An Educated Guess | Calibrate</title>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
		<link rel="stylesheet" media="screen" href="css/bayesian.css"/>
		<link rel="stylesheet" media="screen" href="css/quiz.css"/>
	</head>
	<body>
		<div id="info">
			<h1 id="name">an educated guess</h1>
			<p>
				A tool for calibrated probability estimation
			</p>
		</div>

		<div id="main">
			<h1>
				<a class="nav" href="index.html">about</a> &#160;&#160;&#160;
				calibrate &#160;&#160;&#160;
			</h1>

			<div class="questionContainer radius">
			
				<div class="question"><b>Question 1:</b> Area of Algeria (km2)?</div>
				<div class="answers">
					Low/High: <input type="text" name="q1-low">/<input type="text" name="q1-high"><br>
					Confidence: <input type="text" name="q1-confidence">
				</div>
				<div class="btnContainer">
					<div class="prev"></div>
					<div class="next">
						<a class="btnNext">Next &gt;&gt;</a>
					</div>
					<div class="clear"></div>
				</div>
			</div>
			<div class="questionContainer hide radius">
				<div class="question"><b>Question 2:</b> Area of Germany (km2)?</div>
				<div class="answers">
					Low/High: <input type="text" name="q2-low">/<input type="text" name="q2-high"><br>
					Confidence: <input type="text" name="q2-confidence">
				</div>
				<div class="btnContainer">
					<div class="next">
						<a class="btnNext">Next &gt;&gt;</a>
					</div>
					<div class="clear"></div>
				</div>
			</div>
			
			<div class="questionContainer radius hide">
				<div class="question"><b>Question 3:</b> Area of Malaysia (km2)?</div>
				<div class="answers">
					Low/High: <input type="text" name="q3-low">/<input type="text" name="q3-high"><br>
					Confidence: <input type="text" name="q3-confidence">
				</div>
				<div class="btnContainer">
					<div class="next">
						<a class="btnShowResult">Finish!</a>
					</div>
					<div class="clear"></div>
				</div>
			</div>
			
			
			<div class="txtStatusBar">Status Bar</div>
			<div id="progressKeeper" class="radius">
				<div id="progress"></div>
			</div>
			<div id="resultKeeper" class="radius hide"></div>

		</div>

		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
		<script>
		//<!--
		function assert(condition, message) {
			if (!condition) {
				throw message || "Assertion failed";
			}
		}

		JSON.stringify = JSON.stringify || function (obj) {
			var t = typeof (obj);
			if (t != "object" || obj === null) {
				// simple data type
				if (t == "string") obj = '"'+obj+'"';
				return String(obj);
			}
			else {
				// recurse array or object
				var n, v, json = [], arr = (obj && obj.constructor == Array);
				for (n in obj) {
					v = obj[n]; t = typeof(v);
					if (t == "string") v = '"'+v+'"';
					else if (t == "object" && v !== null) v = JSON.stringify(v);
					json.push((arr ? "" : '"' + n + '":') + String(v));
				}
				return (arr ? "[" : "{") + String(json) + (arr ? "]" : "}");
			}
		};
		
		$("input").keypress(function (e) {
			if ((e.which && e.which == 13) || (e.keyCode && e.keyCode == 13)) {
				$('.btnContainer > .next > a:visible').click();
				return false;
			} else {
				return true;
			}
		});

		$(function(){
			var numQuestions = 3;
			var progressPixels = 600/numQuestions;
			var answers = { q1: 2381741, q2: 357022, q3: 329847 };
			var jQuiz = {
				checkAnswers: function() {					
					var resultArr = [];
					for (var key in this.userAnswers) {		
						var userAnswer = this.userAnswers[key];
						var correctAnswer = answers['q' + userAnswer.n];
						var result = false;
						//alert("answer is " + correctAnswer + "; low is " + userAnswer.low + "; high is " + userAnswer.high);
						if (userAnswer.low <= correctAnswer && correctAnswer <= userAnswer.high) {
							result = true;
						}
						resultArr.push(result);
					}
					return resultArr;
				},
				init: function(){
					$('.btnNext').click(function(){			
						if ($('.answers > input:visible').filter(function() { return !this.value;}).length > 0) {
							// if all inputs are not provided, do not proceed
							return false;
						}
						$(this).parents('.questionContainer').fadeOut(500, function(){
							$(this).next().fadeIn(500);
						});
						var el = $('#progress');
						el.width(el.width() + progressPixels + 'px');
					});
					$('.btnShowResult').click(function(){
						if ($('.answers > input:visible').filter(function() { return !this.value;}).length > 0) {
							// if all inputs are not provided, do not proceed
							return false;
						}
						
						jQuiz.userAnswers = [];						
						
						var lows = $('input[name$="low"]').map(function() { return $(this).val() }).get();
						var highs = $('input[name$="high"]').map(function() { return $(this).val() }).get();
						var confidences = $('input[name$="confidence"]').map(function() { return $(this).val() }).get();
						
						assert((highs.length === lows.length) && (lows.length === confidences.length), "Answer sizes must match.");
						
						for (var i = 0; i < highs.length; i++) {
						    var userAnswer = { 
								n: i + 1,
								low: lows[i],
								high: highs[i],
								confidence: confidences[i]
							};

							jQuiz.userAnswers.push(userAnswer);
						}						
						
						$('#progress').width(300);
						$('#progressKeeper').hide();
						var results = jQuiz.checkAnswers();
						var resultSet = '';
						var trueCount = 0;
						for (var i = 0, ii = results.length; i < ii; i++){
							if (results[i] == true) trueCount++;
							resultSet += '<div> Question ' + (i + 1) + ' is ' + results[i] + '</div>'
						}
						resultSet += '<div class="totalScore">Your total score is ' + parseInt(trueCount * (100/numQuestions), 10) + ' / 100</div>'
						$('#resultKeeper').html(resultSet).show();
					})
				}
			};
			jQuiz.init();
		})

		/*
		$(".area-slider").rangeSlider(
			{arrows:false},
			{bounds: {min: 0, max: 7000000}},
			{range: {min: 1}},
			{defaultValues:{min: 0, max: 7000000}},
			{step: 1},
			{formatter: function(val) {
				return val.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
			}}
		);
		*/
		//-->
		</script>
	</body>
</html>
